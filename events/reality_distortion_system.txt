namespace = rds
@Residual_hull_value = 1
@flag_time = 3
ship_event = {
	id = rds.0
	hide_window = yes
	trigger = {
	}
	is_triggered_only = yes
	immediate = {
		ship_event = {
			id = rds.1
		}
	}
}

ship_event = {
	id = rds.1
	hide_window = yes
	trigger = {
		has_component = REALITY_DISTORTION_SYSTEM
		NOT = {
			has_ship_flag = reality_distortion_system_cooldown
		}
	}
	is_triggered_only = no
	immediate = {
		THIS = {
			save_event_target_as = reality_distortion_system_ship
		}
		event_target:reality_distortion_system_ship = {
			set_timed_ship_flag = {
				flag = reality_distortion_system_cooldown
				days = @flag_time
			}
			#NO_UNKEEP
			
			#UNBREAKABLE_SHIP
			if = {
				limit = {
					event_target:reality_distortion_system_ship.fleet = {
						has_fleet_flag = unbreakable_ship
					}
				}
				This = {
					set_disable_at_health = 0.0001
					repair_ship = yes
					set_disabled = no
				}
			}
			else = {
				This = {
					set_disable_at_health = 0
					repair_ship = yes
					set_disabled = no
				}
			}
			#NO_DISENGAGE
			if = {
				limit = {
					event_target:reality_distortion_system_ship.fleet = {
						has_fleet_flag = no_disengage
					}
				}
				export_modifier_to_variable = {
					modifier = ship_disengage_chance_reduction
					variable = ship_disengage_chance_reduction_number
				}
				multiply_variable = {
					which = ship_disengage_chance_reduction_number
					value = -1
				}
				change_variable = {
					which = ship_disengage_chance_reduction_number
					value = 1
				}
				if = {
					limit = {
						check_modifier_value = {	modifier = ship_disengage_chance_reduction value < 1.00	}
					}
					remove_modifier = swn_mod_ship_disengage_chance_reduction
					add_modifier = {	modifier = swn_mod_ship_disengage_chance_reduction	months = 1	multiplier = ship_disengage_chance_reduction_number	}
				}
			}
		}
		if = {
			limit = {
				NOT = {
					fleet = {
						has_fleet_flag = reality_distortion_system_cooldown
					}
				}
			}
			fleet = {
				set_timed_fleet_flag = {
					flag = reality_distortion_system_cooldown
					days = @flag_time
				}
			}
			THIS.solar_system = {
				every_ship_in_system = {
					limit = {
						if = {
							limit = {
								NOT = {
									event_target:reality_distortion_system_ship.fleet = {
										has_fleet_flag = system_wide
									}
								}
							}
							is_in_combat = yes
						}
						NOT = {
							is_owned_by = event_target:reality_distortion_system_ship.owner
						}
					}
					if = {
						limit = {
							event_target:reality_distortion_system_ship.fleet = {
								has_fleet_flag = ship_hp_amount_reduce_system
							}
						}
						export_trigger_value_to_variable = {
							trigger = has_hp
							variable = ship_hp_amount
						}
						subtract_variable = {
							which = ship_hp_amount
							value = @Residual_hull_value
						}
						reduce_hp = ship_hp_amount
						set_timed_ship_flag = {
							flag = ship_hp_amount_reduce_system_target
							days = @flag_time
						}
					}
					if = {
						limit = {
							event_target:reality_distortion_system_ship.fleet = {
								has_fleet_flag = shield_erasing_system
							}
						}
						export_modifier_to_variable = {
							modifier = ship_shield_reduction
							variable = ship_shield_reduction_number
						}
						multiply_variable = {
							which = ship_shield_reduction_number
							value = -1
						}
						change_variable = {
							which = ship_shield_reduction_number
							value = 1
						}
						if = {
							limit = {
								check_modifier_value = {	modifier = ship_shield_reduction value < 1.00	}
							}
							remove_modifier = swn_mod_ship_shield_reduction
							add_modifier = {	modifier = swn_mod_ship_shield_reduction	months = 1	multiplier = ship_shield_reduction_number	}
						}
					}
					if = {
						limit = {
							event_target:reality_distortion_system_ship.fleet = {
								has_fleet_flag = armor_erasing_system
							}
						}
						export_modifier_to_variable = {
							modifier = ship_armor_reduction
							variable = ship_armor_reduction_number
						}
						multiply_variable = {
							which = ship_armor_reduction_number
							value = -1
						}
						change_variable = {
							which = ship_armor_reduction_number
							value = 1
						}
						if = {
							limit = {
								check_modifier_value = {	modifier = ship_armor_reduction value < 1.00	}
							}
							remove_modifier = swn_mod_ship_armor_reduction
							add_modifier = {	modifier = swn_mod_ship_armor_reduction	months = 1	multiplier = ship_armor_reduction_number	}
						}
					}
					if = {
						limit = {
							event_target:reality_distortion_system_ship.fleet = {
								has_fleet_flag = narrative_editing_warship_narrative_strike
							}
						}
						destroy_ship = This
					}
					if = {
						limit = {
							event_target:reality_distortion_system_ship.fleet = {
								has_fleet_flag = aggro_range_editor
							}
						}
						fleet = {
							set_aggro_range = 0
						}
					}
					if = {
						limit = {
							event_target:reality_distortion_system_ship.fleet = {
								has_fleet_flag = anti_hull_repair
							}
						}
						export_modifier_to_variable = {
							modifier = ship_hull_regen_add_perc
							variable = ship_hull_regen_add_perc_number
						}
						multiply_variable = {
							which = ship_hull_regen_add_perc_number
							value = 1
						}
						change_variable = {
							which = ship_hull_regen_add_perc_number
							value = 0
						}
						if = {
							limit = {
								check_modifier_value = {	modifier = ship_hull_regen_add_perc value > 0.00	}
							}
							remove_modifier = swn_mod_ship_hull_repair_anti
							add_modifier = {	modifier = swn_mod_ship_hull_repair_anti	months = 1	multiplier = ship_hull_regen_add_perc_number	}
						}
						export_modifier_to_variable = {
							modifier = ship_hull_regen_add_static
							variable = ship_hull_regen_add_static_number
						}
						multiply_variable = {
							which = ship_hull_regen_add_static_number
							value = 1
						}
						change_variable = {
							which = ship_hull_regen_add_static_number
							value = 0
						}
						if = {
							limit = {
								check_modifier_value = {	modifier = ship_hull_regen_add_static value > 0.00	}
							}
							remove_modifier = swn_mod_ship_hull_repair_anti_static
							add_modifier = {	modifier = swn_mod_ship_hull_repair_anti_static	months = 1	multiplier = ship_hull_regen_add_static_number	}
						}
					}
					if = {
						limit = {
							event_target:reality_distortion_system_ship.fleet = {
								has_fleet_flag = speed_reduction
							}
						}
						export_modifier_to_variable = {
							modifier = ship_speed_reduction
							variable = ship_speed_reduction_number
						}
						multiply_variable = {
							which = ship_speed_reduction_number
							value = -1
						}
						change_variable = {
							which = ship_speed_reduction_number
							value = 1
						}
						if = {
							limit = {
								check_modifier_value = {	modifier = ship_speed_reduction value < 1.00	}
							}
							remove_modifier = swn_mod_ship_speed_reduction
							add_modifier = {	modifier = swn_mod_ship_speed_reduction	months = 1	multiplier = ship_speed_reduction_number	}
						}
					}
					if = {
						limit = {
							event_target:reality_distortion_system_ship.fleet = {
								has_fleet_flag = no_disabled_ship
							}
							set_disable_at_health = 0
						}
					}
				}
			}
		}
		ship_event = {
			id = rds.0
			day = 3
			scopes = { THIS = THIS }
		}
	}
}

event = {
	id = rds.2
	hide_window = yes
	trigger = {
	}
	is_triggered_only = yes
	immediate = {
		if = {
			limit = {
				This.fleet = {
					has_fleet_flag = unbreakable_ship
				}
				has_component = REALITY_DISTORTION_SYSTEM
			}
			This = {
				repair_ship = yes
				set_disabled = no
				ship_event = {
					id = rds.1
				}
			}
		}
	}
}

ship_event = {
	id = rds.3
	hide_window = yes
	trigger = {
	}
	is_triggered_only = yes
	immediate = {
		fleet = {
			remove_fleet_flag = reality_distortion_system_cooldown
		}
		remove_ship_flag = reality_distortion_system_cooldown
		ship_event = {
			id = rds.1
		}
	}
}

event = {
	id = rds.4
	hide_window = yes
	trigger = {
	}
	is_triggered_only = yes
	immediate = {
		ship_event = {
			id = rds.1
		}
	}
}

event = {
	id = rds.6
	hide_window = yes
	trigger = {
	}
	is_triggered_only = yes
	immediate = {
		This = {
			if = {
				limit = {
					has_ship_flag = ship_hp_amount_reduce_system_target
				}
				export_trigger_value_to_variable = {
					trigger = has_hp
					variable = ship_hp_amount
				}
				subtract_variable = {
					which = ship_hp_amount
					value = @Residual_hull_value
				}
				reduce_hp = ship_hp_amount
			}
		}
	}
}

planet_event = {
	id = rds.7
	hide_window = yes
	trigger = {
		
	}
	is_triggered_only = yes
	immediate = {
		#NO_JOB_UPKEEP
		dynamic_modifier = { MODIFIER = planet_jobs_upkeep_mult MULTIPLY = -1 CHANGE = -1 }
		#NO_POPS_UPKEEP
		dynamic_modifier = { MODIFIER = planet_pops_organics_upkeep_mult MULTIPLY = -1 CHANGE = -1 }
		dynamic_modifier = { MODIFIER = planet_pops_robotics_upkeep_mult MULTIPLY = -1 CHANGE = -1 }
		#NO_PLANET_STRUTURE_UPKEEP
		dynamic_modifier = { MODIFIER = planet_structures_upkeep_mult MULTIPLY = -1 CHANGE = -1 }
		#POP_DO_NOT_NEED_HOUSE
		dynamic_modifier = { MODIFIER = pop_housing_usage_mult MULTIPLY = -1 CHANGE = -1 }
	}
}

planet_event = {
	id = rds.8
	hide_window = yes
	trigger = {
		
	}
	is_triggered_only = yes
	immediate = {
		remove_modifier = swn_mod_planet_jobs_upkeep_mult
		remove_modifier = swn_mod_planet_pops_organics_upkeep_mult
		remove_modifier = swn_mod_planet_pops_robotics_upkeep_mult
		remove_modifier = swn_mod_planet_structures_upkeep_mult
		remove_modifier = swn_mod_pop_housing_usage_mult
	}
}